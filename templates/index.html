<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP å…¨æ™¯ä¾¦æ¢</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #e2e8f0; --accent: #38bdf8; --border: #334155; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 1000px; }
        
        /* é¡¶éƒ¨å¤§å¡ç‰‡ */
        .hero-card { background: var(--card); padding: 40px; border-radius: 16px; text-align: center; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); position: relative; overflow: hidden; }
        .ip-text { font-size: 3.5rem; font-weight: 800; color: var(--accent); text-shadow: 0 0 30px rgba(56, 189, 248, 0.2); margin: 10px 0; letter-spacing: 1px; word-break: break-all; }
        .location-text { font-size: 1.2rem; color: #94a3b8; display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        /* ä¿¡ä»»åˆ†æ¡ */
        .score-container { margin-top: 20px; max-width: 400px; margin-left: auto; margin-right: auto; }
        .score-bar-bg { background: #334155; height: 8px; border-radius: 4px; overflow: hidden; }
        .score-bar-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }
        .score-text { display: flex; justify-content: space-between; font-size: 12px; color: #94a3b8; margin-top: 5px; }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .panel { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 20px; }
        .panel-title { font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        
        /* ä¿¡æ¯è¡Œ */
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #334155; font-size: 0.95rem; }
        .info-row:last-child { border-bottom: none; }
        .label { color: #94a3b8; }
        .value { color: #fff; font-weight: 500; text-align: right; }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .tag-green { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .tag-red { background: rgba(244, 63, 94, 0.2); color: #f43f5e; }

        /* åœ°å›¾ */
        #map { height: 250px; width: 100%; border-radius: 8px; z-index: 1; }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 600px) { .ip-text { font-size: 2.5rem; } .grid-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero-card">
            <div style="text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 2px;">Your Public IP</div>
            <div class="ip-text">{{ ip }}</div>
            <div class="location-text">
                <span>ğŸš© {{ data.get('country', '-') }}</span>
                <span>ğŸ™ï¸ {{ data.get('city', '-') }}</span>
            </div>
            
            <div class="score-container">
                <div class="score-bar-bg">
                    <div class="score-bar-fill" style="width: {{ score }}%; background: {{ 'linear-gradient(90deg, #f43f5e, #fbbf24)' if score < 60 else 'linear-gradient(90deg, #34d399, #38bdf8)' }};"></div>
                </div>
                <div class="score-text">
                    <span>IP çº¯å‡€åº¦è¯„åˆ†</span>
                    <span style="color: #fff; font-weight: bold;">{{ score }} / 100</span>
                </div>
            </div>
        </div>

        <div class="grid-container">
            
            <div class="panel">
                <div class="panel-title">ğŸ“¡ ç½‘ç»œæŒ‡çº¹ (Network)</div>
                <div class="info-row"><span class="label">è¿è¥å•† (ISP)</span><span class="value">{{ data.get('isp', '-') }}</span></div>
                <div class="info-row"><span class="label">ASN ç»„ç»‡</span><span class="value">{{ data.get('org', '-') }}</span></div>
                <div class="info-row"><span class="label">AS ç¼–å·</span><span class="value">{{ data.get('as', '-') }}</span></div>
                <div class="info-row"><span class="label">ç½‘ç»œç±»å‹</span>
                    <span class="value">
                        {% if data.get('mobile') %}<span class="tag tag-green">ç§»åŠ¨ç½‘ç»œ</span>
                        {% elif data.get('hosting') %}<span class="tag tag-red">æ•°æ®ä¸­å¿ƒ</span>
                        {% else %}<span class="tag tag-green">å®¶åº­å®½å¸¦</span>{% endif %}
                    </span>
                </div>
                <div class="info-row"><span class="label">ä»£ç†æ£€æµ‹</span>
                    <span class="value">
                        {% if data.get('proxy') %}<span class="tag tag-red">æ£€æµ‹åˆ°ä»£ç†</span>
                        {% else %}<span class="tag tag-green">æ— æ˜æ˜¾ç—•è¿¹</span>{% endif %}
                    </span>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">ğŸŒ ç‰©ç†å®šä½ (Geolocation)</div>
                <div id="map"></div>
                <div class="info-row" style="margin-top:10px;"><span class="label">ç»çº¬åº¦</span><span class="value">{{ data.get('lat') }}, {{ data.get('lon') }}</span></div>
                <div class="info-row"><span class="label">æ—¶åŒº</span><span class="value">{{ data.get('timezone', '-') }}</span></div>
            </div>

            <div class="panel">
                <div class="panel-title">ğŸ•µï¸ æµè§ˆå™¨ç¯å¢ƒ (Client Side)</div>
                <div class="info-row"><span class="label">æ“ä½œç³»ç»Ÿ</span><span class="value" id="os">-</span></div>
                <div class="info-row"><span class="label">å±å¹•åˆ†è¾¨ç‡</span><span class="value" id="screen">-</span></div>
                <div class="info-row"><span class="label">æµè§ˆå™¨è¯­è¨€</span><span class="value" id="lang">-</span></div>
                <div class="info-row"><span class="label">æµè§ˆå™¨æ ¸å¿ƒ</span><span class="value" id="browser">-</span></div>
                <div class="info-row"><span class="label">å½“å‰æ—¶é—´</span><span class="value" id="time">-</span></div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px; color: #475569; font-size: 12px;">
            Data powered by ip-api & Cloudflare | User-Agent: {{ ua }}
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. åˆå§‹åŒ–åœ°å›¾
        var lat = {{ data.get('lat', 0) }};
        var lon = {{ data.get('lon', 0) }};
        if (lat && lon) {
            var map = L.map('map').setView([lat, lon], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
            L.marker([lat, lon]).addTo(map)
                .bindPopup('IP å½’å±åœ°: {{ data.get("city") }}')
                .openPopup();
        } else {
            document.getElementById('map').innerHTML = '<div style="text-align:center; line-height:250px; color:#64748b;">æ— æ³•è·å–åœ°å›¾åæ ‡</div>';
        }

        // 2. æµè§ˆå™¨æŒ‡çº¹æ£€æµ‹
        document.getElementById('screen').innerText = window.screen.width + ' x ' + window.screen.height;
        document.getElementById('lang').innerText = navigator.language;
        document.getElementById('time').innerText = new Date().toLocaleTimeString();
        
        // ç®€å•çš„ OS å’Œ æµè§ˆå™¨æ£€æµ‹
        var ua = navigator.userAgent;
        var os = "æœªçŸ¥ç³»ç»Ÿ";
        if (ua.indexOf("Win") != -1) os = "Windows";
        if (ua.indexOf("Mac") != -1) os = "macOS";
        if (ua.indexOf("Linux") != -1) os = "Linux";
        if (ua.indexOf("Android") != -1) os = "Android";
        if (ua.indexOf("iPhone") != -1) os = "iOS";
        document.getElementById('os').innerText = os;

        var browser = "æœªçŸ¥æµè§ˆå™¨";
        if (ua.indexOf("Chrome") != -1) browser = "Chrome";
        if (ua.indexOf("Firefox") != -1) browser = "Firefox";
        if (ua.indexOf("Safari") != -1 && ua.indexOf("Chrome") == -1) browser = "Safari";
        document.getElementById('browser').innerText = browser;
    </script>
</body>
</html>
